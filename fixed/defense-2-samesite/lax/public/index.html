<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Defensa 2B: SameSite=Lax</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .hero {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        padding: 80px 0;
      }
    </style>
  </head>
  <body>
    <div class="hero">
      <div class="container text-center">
        <h1 class="display-4 fw-bold">‚öñÔ∏è Defensa 2B: SameSite=Lax</h1>
        <p class="lead">
          Protecci√≥n inteligente - El equilibrio perfecto ‚≠ê RECOMENDADO
        </p>
        <div class="mt-4">
          <a href="/iniciar-sesion" class="btn btn-light btn-lg me-2"
            >Iniciar sesi√≥n</a
          >
          <a href="/cuenta" class="btn btn-outline-light btn-lg">Ver cuenta</a>
        </div>
      </div>
    </div>

    <div class="container py-5">
      <div class="row">
        <div class="col-md-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body">
              <h5 class="card-title">üç™ ¬øQu√© es?</h5>
              <p class="card-text">
                Una configuraci√≥n de cookie que
                <strong>permite enlaces GET (navegaci√≥n)</strong> pero
                <strong>bloquea formularios POST cross-site</strong>. El mejor
                balance seguridad/usabilidad.
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body">
              <h5 class="card-title">‚öôÔ∏è ¬øC√≥mo funciona?</h5>
              <ol class="small mb-0">
                <li>Servidor marca cookie: <code>sameSite: "lax"</code></li>
                <li>
                  Navegaci√≥n GET top-level: <strong>‚úÖ Env√≠a cookie</strong>
                </li>
                <li>
                  POST/iframe/img cross-site:
                  <strong>‚ùå NO env√≠a cookie</strong>
                </li>
                <li>Ataques CSRF bloqueados, UX intacta</li>
              </ol>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body">
              <h5 class="card-title">‚úÖ Usado por</h5>
              <ul class="small mb-0">
                <li>
                  <strong>Chrome y Firefox</strong> (valor por defecto desde
                  2020)
                </li>
                <li><strong>GitHub</strong></li>
                <li><strong>Google</strong></li>
                <li><strong>Facebook</strong></li>
                <li>
                  <strong>‚≠ê Recomendado para 95% de apps web</strong>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12">
          <div class="card bg-light">
            <div class="card-body">
              <h5>üìä Diagrama del flujo</h5>
              <div class="bg-white p-3 border rounded">
                <pre class="mb-0">
<strong>Escenario 1: Usuario hace clic en enlace de email (GET top-level)</strong>

1. Usuario recibe email con link: https://banco.com/cuenta
   ‚Üì
2. Usuario hace clic ‚Üí Navegador hace GET a banco.com
   ‚Üì
3. <strong>Navegador detecta: "Es navegaci√≥n top-level GET"</strong>
   ‚Üì
4. <strong>Navegador verifica cookie: SameSite=Lax</strong>
   ‚Üì
5. <strong>Navegador decide: ‚úÖ S√ç env√≠o la cookie (para UX)</strong>
   ‚Üì
6. Usuario llega con sesi√≥n iniciada
   ‚Üì
7. üéâ <strong>UX perfecta - Sin re-login</strong>

---

<strong>Escenario 2: Sitio atacante intenta CSRF con POST</strong>

1. Usuario autenticado en localhost:3021 (banco)
   ‚Üì
2. Usuario visita localhost:3001 (sitio atacante)
   ‚Üì
3. Sitio atacante env√≠a formulario POST a localhost:3021/transferencia
   ‚Üì
4. <strong>Navegador detecta: "POST cross-site (3001 ‚Üí 3021)"</strong>
   ‚Üì
5. <strong>Navegador verifica cookie: SameSite=Lax</strong>
   ‚Üì
6. <strong>Navegador decide: ‚ùå NO env√≠o la cookie (no es navegaci√≥n top-level)</strong>
   ‚Üì
7. Servidor recibe petici√≥n SIN cookie de sesi√≥n
   ‚Üì
8. Servidor: "No hay sesi√≥n" ‚Üí 401 Unauthorized
   ‚Üì
9. üéâ <strong>Ataque bloqueado</strong>

<strong>üéØ La clave: Lax es inteligente</strong>
- Permite GET navegaci√≥n (clic en links) ‚Üí Buena UX
- Bloquea POST/iframe cross-site ‚Üí Seguridad contra CSRF
- El 99% de ataques CSRF usan POST o GET en iframes/im√°genes
                </pre>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-success text-white">
              <h6 class="mb-0">‚úÖ Ventajas</h6>
            </div>
            <div class="card-body">
              <ul class="mb-0">
                <li>
                  <strong>‚≠ê Valor por defecto</strong> en Chrome/Firefox
                  modernos
                </li>
                <li><strong>Protecci√≥n contra 99% de ataques CSRF</strong></li>
                <li><strong>Enlaces externos funcionan</strong> (buena UX)</li>
                <li><strong>Una sola l√≠nea de c√≥digo</strong></li>
                <li><strong>No requiere cambios en HTML</strong></li>
                <li><strong>Compatible con navegadores modernos</strong></li>
                <li><strong>Mejor balance seguridad/usabilidad</strong></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-warning">
              <h6 class="mb-0">‚ö†Ô∏è Consideraciones</h6>
            </div>
            <div class="card-body">
              <ul class="mb-0">
                <li>
                  <strong>GET vulnerable:</strong> Si tu app cambia estado con
                  GET (mala pr√°ctica), Lax NO protege
                </li>
                <li>
                  <strong>No protege contra subdominios</strong> comprometidos
                </li>
                <li>
                  <strong>Navegadores antiguos:</strong> IE11 y anteriores no lo
                  soportan
                </li>
                <li>
                  <strong>Mejor combinado con tokens</strong> para defensa en
                  profundidad
                </li>
                <li>
                  <strong>No protege APIs:</strong> Requiere enfoque diferente
                  (CORS + tokens)
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                ‚öñÔ∏è Tabla de comportamiento: ¬øCu√°ndo env√≠a la cookie?
              </h5>
            </div>
            <div class="card-body">
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Tipo de petici√≥n</th>
                    <th>Ejemplo</th>
                    <th>¬øCookie enviada?</th>
                    <th>Raz√≥n</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Navegaci√≥n same-site</td>
                    <td>Clic dentro de localhost:3021</td>
                    <td>‚úÖ S√ç</td>
                    <td>Mismo sitio</td>
                  </tr>
                  <tr class="table-success">
                    <td>Enlace GET externo (top-level)</td>
                    <td>Email con link a localhost:3021</td>
                    <td>‚úÖ S√ç</td>
                    <td>Navegaci√≥n top-level permitida</td>
                  </tr>
                  <tr>
                    <td>Formulario same-site</td>
                    <td>POST desde localhost:3021/cuenta</td>
                    <td>‚úÖ S√ç</td>
                    <td>Mismo sitio</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Formulario POST cross-site</td>
                    <td>POST desde localhost:3001 (atacante)</td>
                    <td>‚ùå NO</td>
                    <td>No es navegaci√≥n top-level</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Iframe cross-site</td>
                    <td>Iframe embebido en otro dominio</td>
                    <td>‚ùå NO</td>
                    <td>No es navegaci√≥n top-level</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Imagen/script cross-site</td>
                    <td>&lt;img src="localhost:3021/donar"&gt;</td>
                    <td>‚ùå NO</td>
                    <td>No es navegaci√≥n top-level</td>
                  </tr>
                  <tr class="table-danger">
                    <td>AJAX/Fetch cross-site</td>
                    <td>fetch() desde otro dominio</td>
                    <td>‚ùå NO</td>
                    <td>No es navegaci√≥n top-level</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="alert alert-info mt-4">
        <h6>üí° Ejemplo de c√≥digo (Node.js/Express):</h6>
        <pre class="bg-white p-3 rounded mb-0"><code>app.use(session({
  secret: "clave-secreta",
  resave: false,
  saveUninitialized: true,
  cookie: {
    secure: false,   // En producci√≥n: true (requiere HTTPS)
    sameSite: "lax"  // ‚≠ê La configuraci√≥n recomendada
  }
}));

// ¬°Y listo! No necesitas m√°s c√≥digo para protecci√≥n CSRF b√°sica</code></pre>
      </div>

      <div class="alert alert-success mt-3">
        <h6>üéØ ¬øPor qu√© Lax es el est√°ndar?</h6>
        <p class="mb-2">
          Desde 2020, Chrome y Firefox usan
          <strong>SameSite=Lax por defecto</strong> en cookies sin configuraci√≥n
          expl√≠cita. Esto significa que:
        </p>
        <ul class="mb-0">
          <li>
            Las apps modernas ya tienen protecci√≥n CSRF b√°sica sin c√≥digo
            adicional
          </li>
          <li>
            Los ataques CSRF tradicionales (POST cross-site) fallan por defecto
          </li>
          <li>La UX no se ve afectada (enlaces de email funcionan)</li>
          <li>Es el mejor balance que encontr√≥ la industria</li>
        </ul>
      </div>

      <div class="alert alert-primary mt-3">
        <h6>üéì Para tu presentaci√≥n:</h6>
        <ul class="mb-0">
          <li>
            <strong>Analog√≠a:</strong> El navegador es un guardi√°n inteligente
            que permite tr√°fico leg√≠timo (enlaces) pero bloquea ataques
            (formularios externos)
          </li>
          <li>
            Explica los <strong>dos escenarios</strong>: email con link (‚úÖ) vs
            ataque POST (‚ùå)
          </li>
          <li>
            Menciona que es el <strong>est√°ndar de Chrome desde 2020</strong>
          </li>
          <li>
            Demuestra que el ataque desde localhost:3001
            <strong>falla autom√°ticamente</strong>
          </li>
          <li>
            Recomienda <strong>Lax + Tokens</strong> para defensa en profundidad
          </li>
        </ul>
      </div>

      <div class="text-center mt-5">
        <a href="../public/index.html" class="btn btn-outline-secondary me-2"
          >‚Üê Volver a comparativa SameSite</a
        >
        <a href="http://localhost:3001" target="_blank" class="btn btn-danger"
          >Probar ataque desde localhost:3001</a
        >
      </div>
    </div>
  </body>
</html>
