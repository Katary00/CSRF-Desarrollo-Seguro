<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Defensa 2A: SameSite=Strict</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .hero {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        color: white;
        padding: 80px 0;
      }
    </style>
  </head>
  <body>
    <div class="hero">
      <div class="container text-center">
        <h1 class="display-4 fw-bold">üîí Defensa 2A: SameSite=Strict</h1>
        <p class="lead">Bloqueo total - M√°xima seguridad</p>
        <div class="mt-4">
          <a href="/iniciar-sesion" class="btn btn-light btn-lg me-2"
            >Iniciar sesi√≥n</a
          >
          <a href="/cuenta" class="btn btn-outline-light btn-lg">Ver cuenta</a>
        </div>
      </div>
    </div>

    <div class="container py-5">
      <div class="row">
        <div class="col-md-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body">
              <h5 class="card-title">üç™ ¬øQu√© es?</h5>
              <p class="card-text">
                Una configuraci√≥n de cookie que ordena al navegador
                <strong
                  >NO enviar la cookie en NINGUNA petici√≥n cross-site</strong
                >. Bloqueo total.
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body">
              <h5 class="card-title">‚öôÔ∏è ¬øC√≥mo funciona?</h5>
              <ol class="small mb-0">
                <li>Servidor marca cookie: <code>sameSite: "strict"</code></li>
                <li>Usuario inicia sesi√≥n ‚Üí cookie guardada</li>
                <li>Sitio externo intenta hacer petici√≥n</li>
                <li>
                  Navegador: "Es cross-site" ‚Üí <strong>NO env√≠a cookie</strong>
                </li>
                <li>Servidor no reconoce usuario ‚Üí Rechaza</li>
              </ol>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body">
              <h5 class="card-title">‚úÖ Usado por</h5>
              <ul class="small mb-0">
                <li><strong>Bancos</strong> (apps financieras)</li>
                <li><strong>Sistemas cr√≠ticos</strong> (salud, gobierno)</li>
                <li><strong>Aplicaciones de alta seguridad</strong></li>
                <li><strong>Portales empresariales</strong></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12">
          <div class="card bg-light">
            <div class="card-body">
              <h5>üìä Diagrama del flujo</h5>
              <div class="bg-white p-3 border rounded">
                <pre class="mb-0">
<strong>Escenario: Usuario autenticado en localhost:3020 (banco)</strong>

1. Usuario inicia sesi√≥n en localhost:3020
   ‚Üì
2. Servidor env√≠a cookie de sesi√≥n:
   Set-Cookie: connect.sid=abc123; SameSite=Strict üîí
   ‚Üì
3. Navegador guarda cookie con restricci√≥n Strict
   ‚Üì
4. Usuario visita localhost:3001 (sitio atacante)
   ‚Üì
5. Sitio atacante env√≠a formulario POST a localhost:3020
   ‚Üì
6. <strong>Navegador detecta: "Petici√≥n cross-site (3001 ‚Üí 3020)"</strong>
   ‚Üì
7. <strong>Navegador verifica cookie: SameSite=Strict</strong>
   ‚Üì
8. <strong>Navegador decide: ‚ùå NO env√≠o la cookie</strong>
   ‚Üì
9. Servidor recibe petici√≥n SIN cookie de sesi√≥n
   ‚Üì
10. Servidor: "No hay sesi√≥n" ‚Üí 401 Unauthorized
    ‚Üì
11. üéâ <strong>Ataque bloqueado</strong>

<strong>üéØ Por qu√© el atacante falla:</strong>
- El navegador es el guardi√°n: NO env√≠a cookies en peticiones cross-site
- Sin cookie = sin sesi√≥n = sin autorizaci√≥n
- No requiere c√≥digo adicional en formularios
                </pre>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-success text-white">
              <h6 class="mb-0">‚úÖ Ventajas</h6>
            </div>
            <div class="card-body">
              <ul class="mb-0">
                <li><strong>Protecci√≥n m√°xima</strong> contra CSRF</li>
                <li>
                  <strong>Una sola l√≠nea de c√≥digo</strong> en el servidor
                </li>
                <li><strong>No requiere cambios en HTML</strong></li>
                <li><strong>Protecci√≥n autom√°tica</strong> del navegador</li>
                <li>
                  <strong>No puede ser bypaseado</strong> desde JavaScript
                </li>
                <li><strong>Compatible con navegadores modernos</strong></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-warning">
              <h6 class="mb-0">‚ö†Ô∏è Consideraciones</h6>
            </div>
            <div class="card-body">
              <ul class="mb-0">
                <li>
                  <strong>Rompe enlaces externos:</strong> Si recibes un link
                  por email, llegar√°s sin sesi√≥n iniciada
                </li>
                <li>
                  <strong>UX afectada:</strong> Usuario debe iniciar sesi√≥n
                  nuevamente si viene de otro sitio
                </li>
                <li>
                  <strong>No apto para:</strong> Redes sociales, foros, sitios
                  colaborativos
                </li>
                <li>
                  <strong>Solo navegadores modernos:</strong> IE11 y anteriores
                  no lo soportan
                </li>
                <li>
                  <strong>Muy restrictivo</strong> para la mayor√≠a de apps web
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">
                üîí Tabla de comportamiento: ¬øCu√°ndo env√≠a la cookie?
              </h5>
            </div>
            <div class="card-body">
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Tipo de navegaci√≥n</th>
                    <th>Ejemplo</th>
                    <th>¬øCookie enviada?</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Navegaci√≥n same-site</td>
                    <td>Clic en enlace dentro de localhost:3020</td>
                    <td>‚úÖ S√ç</td>
                  </tr>
                  <tr>
                    <td>Formulario same-site</td>
                    <td>POST desde localhost:3020/cuenta</td>
                    <td>‚úÖ S√ç</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Enlace externo</td>
                    <td>Email con link a localhost:3020</td>
                    <td>‚ùå NO</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Formulario cross-site</td>
                    <td>POST desde localhost:3001 (atacante)</td>
                    <td>‚ùå NO</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Iframe cross-site</td>
                    <td>Iframe embebido en otro dominio</td>
                    <td>‚ùå NO</td>
                  </tr>
                  <tr class="table-danger">
                    <td>Imagen cross-site</td>
                    <td>&lt;img src="localhost:3020/donar"&gt;</td>
                    <td>‚ùå NO</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="alert alert-info mt-4">
        <h6>üí° Ejemplo de c√≥digo (Node.js/Express):</h6>
        <pre class="bg-white p-3 rounded mb-0"><code>app.use(session({
  secret: "clave-secreta",
  resave: false,
  saveUninitialized: true,
  cookie: {
    secure: false,      // En producci√≥n: true (requiere HTTPS)
    sameSite: "strict"  // üîí La l√≠nea m√°gica
  }
}));</code></pre>
      </div>

      <div class="alert alert-primary mt-3">
        <h6>üéì Para tu presentaci√≥n:</h6>
        <ul class="mb-0">
          <li>
            <strong>Analog√≠a:</strong> El navegador es un guardi√°n que NO deja
            pasar las credenciales a sitios externos
          </li>
          <li>
            Demuestra el <strong>problema de UX</strong>: Abre un enlace desde
            un email ‚Üí no hay sesi√≥n
          </li>
          <li>
            Muestra en DevTools (Application ‚Üí Cookies) la columna
            <strong>SameSite=Strict</strong>
          </li>
          <li>Explica cu√°ndo S√ç usar Strict: bancos, sistemas cr√≠ticos</li>
          <li>
            Menciona que <strong>Lax es mejor opci√≥n</strong> para la mayor√≠a de
            apps
          </li>
        </ul>
      </div>

      <div class="text-center mt-5">
        <a href="../public/index.html" class="btn btn-outline-secondary me-2"
          >‚Üê Volver a comparativa SameSite</a
        >
        <a href="http://localhost:3001" target="_blank" class="btn btn-danger"
          >Probar ataque desde localhost:3001</a
        >
      </div>
    </div>
  </body>
</html>
